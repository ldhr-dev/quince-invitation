---
import eventConfig from '@data/event-config.json';

const { ceremony, reception } = eventConfig;
---

<section class="maps-section section" id="ubicaciones">
  <div class="container">
    <h2 class="text-center text-primary">¿Cómo llegar?</h2>
    
    <div class="maps-grid">
      <div class="map-item fade-in">
        <h3>{ceremony.venue}</h3>
        <p class="map-address">{ceremony.address}</p>
        <div class="map-container">
          <iframe
            src={ceremony.mapUrl}
            width="100%"
            height="100%"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            title={`Mapa de ${ceremony.venue}`}
          ></iframe>
        </div>
        <a 
          href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ceremony.venue + ' ' + ceremony.address)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn-outline map-btn"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          Ver en Google Maps
        </a>
      </div>

      <div class="map-item fade-in">
        <h3>{reception.venue}</h3>
        <p class="map-address">{reception.address}</p>
        <div class="map-container">
          <iframe
            src={reception.mapUrl}
            width="100%"
            height="100%"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            title={`Mapa de ${reception.venue}`}
          ></iframe>
        </div>
        <a 
          href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(reception.venue + ' ' + reception.address)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn-outline map-btn"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          Ver en Google Maps
        </a>
      </div>
    </div>
  </div>
</section>

<style>
  .maps-section {
    /* Background now handled by global styles */
  }

  .maps-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 3rem;
    margin-top: 3rem;
  }

  .map-item {
    background: rgba(255, 255, 255, 0.92);
    padding: 2rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
  }

  .map-item h3 {
    color: var(--color-primary);
    margin-bottom: 0.5rem;
    font-size: 1.5rem;
  }

  .map-address {
    color: var(--color-gray);
    margin-bottom: 1.5rem;
  }

  .map-container {
    width: 100%;
    height: 350px;
    border-radius: var(--radius);
    overflow: hidden;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
  }

  .map-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    justify-content: center;
  }

  @media (max-width: 768px) {
    .maps-grid {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .map-container {
      height: 250px;
    }

    .map-item {
      padding: 1.5rem;
    }
  }
</style>

<script>
  // Lazy load maps when they come into view
  document.addEventListener('DOMContentLoaded', () => {
    const mapIframes = document.querySelectorAll('.map-container iframe');
    
    const mapObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const iframe = entry.target as HTMLIFrameElement;
          // Force reload to ensure map renders properly
          iframe.src = iframe.src;
          mapObserver.unobserve(iframe);
        }
      });
    }, {
      rootMargin: '100px'
    });

    mapIframes.forEach(iframe => mapObserver.observe(iframe));
  });
</script>